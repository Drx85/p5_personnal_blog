{% extends 'layout.twig' %}

{% block title %}
	Blog
{% endblock title %}

{% block content %}
	
	{% if session.role is same as ('admin') or session.role is same as ('publisher') %}
		<p><a class="btn btn-success" href="index.php?controller=page&action=show_add">Ajouter un billet </a></p>
	{% endif %}
	
	<h2>Les derniers billets</h2>
	
	{% for post in blog %}
		
		<h3>{{ post.title }}</h3>
		<p>Posté le {{ post.post_date }} à {{ post.hour_post_time }}h{{ post.minute_post_time }}
			
			{% if post.update_date %}
				(dernière modification le {{ post.update_date }}),
			{% endif %}
			par : {{ post.author }}
			
			{{ post.message | u.truncate(500, '...', false) | nl2br }}
			<a href="index.php?controller=post&action=show&id={{ post.id }}"> Lire la suite</a>
		</p>
		
		{% if session.role is same as ('admin') or session.role is same as ('publisher') %}
			<p><a class="btn btn-danger" href="index.php?controller=post&action=delete&id={{ post.id }}">Supprimer</a>
				<a class="btn btn-secondary" href="index.php?controller=page&action=show_edit&id={{ post.id }}">Modifier</a></p>
		{% endif %}
		
		{% set counter = ( counter | default(-1) ) + 1 %}
		
		{% set displayNb = (comments_number[counter].number_of_comments) %}
		
		{% if displayNb %}
			<p><a href="index.php?controller=post&action=show&id={{ post.id }}">Voir les commentaires ({{ displayNb }})</a></p>
		{% else %}
			<p><a href="index.php?controller=post&action=show&id={{ post.id }}">Il n'y a pas de commentaire sur ce billet. Cliquez ici pour en ajouter un.</a></p>
		{% endif %}
	
	{% endfor %}
	
	<p>
		{% for key, number in array_pages %}
			<a href="index.php?controller=post&action=index&page={{ number }}">{{ number }}</a> |
		{% endfor %}
	</p>

{% endblock content %}